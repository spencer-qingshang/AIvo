# 项目4_2_IPv6静态与默认路由实战 (超详细保姆级)

> **实验目标**：通过配置 IPv6 静态路由，打通全网，实现 PC1 与 PC2 的互通。
> **前置条件**：必须先完成 **项目 4_1** 的所有配置（接口IP已配好，直连能通）。

---

## 一、 配置静态路由 (手把手教学)

### 1. 配置路由器 R1 (去往广州)
R1 需要知道如何到达 PC2 所在的 `2.0` 网段，下一跳是 R2。

```shell
<R1> system-view
# 目标网段: 2001:2::  前缀: 64  下一跳: 2001:12::2 (R2的左手接口)
[R1] ipv6 route-static 2001:2:: 64 2001:12::2
```

### 2. 配置路由器 R2 (中间人指路)
R2 需要同时知道去往“北京”(PC1) 和“广州”(PC2) 的路。

```shell
<R2> system-view
# 去往北京 PC1 (1.0网段)，下一跳找 R1
[R2] ipv6 route-static 2001:1:: 64 2001:12::1

# 去往广州 PC2 (2.0网段)，下一跳找 R3
[R2] ipv6 route-static 2001:2:: 64 2001:23::3
```

### 3. 配置路由器 R3 (配置回程路)
R3 需要知道如何回复数据包给 PC1，否则数据包“有去无回”。

```shell
<R3> system-view
# 去往北京 PC1 (1.0网段)，下一跳找 R2
[R3] ipv6 route-static 2001:1:: 64 2001:23::2
```

---

## 二、 验证全网连通性

### 1. 检查路由表
在 R1 上输入：
`display ipv6 routing-table`
*   **检查**：在列表中寻找 `2001:2::/64`。
*   **确认**：Protocol 列显示为 `Static`，NextHop 显示为 `2001:12::2`。

### 2. Ping 测试
打开 **PC1** 的命令行，输入：
`ping 2001:2::1`

*   **成功标准**：看到 `Reply from 2001:2::1 ...`。
*   **失败排查**：
    *   如果显示 `Request timeout`，请重点检查 **R2** 和 **R3** 的配置。
    *   很多人配置了去的路，忘了配置回来的路（R3 的配置）。

---

## 三、 (进阶) 使用默认路由简化配置

> **场景**：假设 R1 是一台家用路由器，不管去哪里都往外网扔，那就可以用默认路由。

### 1. 在 R1 上修改配置
```shell
<R1> system-view
# 第一步：先删除刚才写的静态路由 (必须先删，否则会冲突或不明显)
[R1] undo ipv6 route-static 2001:2:: 64 2001:12::2

# 第二步：配置默认路由 (:: 0 代表所有网段)
[R1] ipv6 route-static :: 0 2001:12::2
```

### 2. 再次验证
再次在 PC1 上 `ping 2001:2::1`，依然应该是通的。
此时在 R1 查路由表，会看到一条 `::/0` 的 Static 路由。

---

## 四、 常见错误自查
1.  **下一跳写错了**：
    *   R1 的下一跳必须是直连的 R2 (`2001:12::2`)。
    *   绝对不能跳过 R2 直接写 R3 的地址，那是“瞬移”，路由器做不到。
2.  **掩码写错**：
    *   IPv6 的掩码通常是 `64`。不要习惯性写成 IPv4 的 24 或 255.255.255.0。
