# 项目2：运用交换机构建小型园区网络 (权威考试版)

## 一、 VLAN 技术 (虚拟局域网)

### 1. [通俗理解]
VLAN 就像在办公室里拉起“隔音帘”。财务部和技术部虽然在同一个大房间（交换机），但拉上帘子后，广播信息就不再乱飞。

### 2. [核心知识点] (识记/填空/简答)
*   **作用**：隔离广播域、增强网络安全性、提高管理灵活性。
*   **标准协议**：**IEEE 802.1Q**。
*   **帧格式 (Tag)**：插入在“源MAC”与“类型”字段之间，长度为 **4 字节**。
    *   **TPID (2字节)**：固定值 `0x8100`，表示这是 802.1Q 帧。
    *   **TCI (2字节)**：包含优先级、CFI 和 **VLAN ID**。
*   **VLAN ID 范围**：**0 ~ 4095**（共 4096 个）。
    *   **可用范围**：**1 ~ 4094**。
    *   **默认 VLAN**：VLAN 1。
*   **划分方式**：最常用的是**基于端口划分**（物理层），此外还有基于 MAC 地址、协议、子网等。

---

## 二、 交换机端口类型 (Access/Trunk)

### 1. [通俗理解]
Access 是部门“内网口”，Trunk 是部门间的“公用高速路”。数据的标签在进出这些门口时，保安（交换机）会有摘掉或贴上的动作。

### 2. [核心知识点] (选择/应用/填空)
*   **PVID (Port Default VLAN ID)**：接口默认的 VLAN ID。

| 端口类型 | 入方向 (Receiving) 处理逻辑 | 出方向 (Sending) 处理逻辑 |
| :--- | :--- | :--- |
| **Access** | 接收不带标签的帧，强制打上 PVID 标签。 | 检查标签是否与 PVID 相同，若相同则**剥离标签**发送。 |
| **Trunk** | 1. 检查 VLAN ID 是否在 `allow-pass` 列表。<br>2. 若在列表则透传；若不带标签则打上 PVID。 | 1. 检查 VLAN ID 是否在允许列表。<br>2. **带标签发送**（例外：若 ID 等于 PVID，则剥离发送）。 |

---

## 三、 STP 生成树协议

### 1. [通俗理解]
为了防止接线接成死循环（环路）导致网络瘫痪，STP 扮演了“交警”角色，通过逻辑上锁死（阻塞）某条路来消除环路。

### 2. [核心知识点] (简答/填空)
*   **作用**：消除环路、链路冗余（备份）。
*   **关键报文**：**BPDU** (Bridge Protocol Data Unit，桥协议数据单元)。
*   **选举依据 (桥ID/BID)**：**优先级 (Priority)** + **MAC 地址**。
    *   **默认优先级**：**32768**（范围 0-61440，必须是 4096 的倍数）。
    *   **选举原则**：**越小越优**。
*   **端口状态 (States)**：
    *   **Forwarding**：正常转发。
    *   **Learning**：学习 MAC 地址，不转发。
    *   **Discarding/Blocking**：不转发数据，不学习 MAC，仅接收 BPDU。
*   **收敛延迟**：普通 STP 从阻塞到转发需要 **30 秒** (Forward Delay x 2)。

---

## 四、 链路聚合 (Eth-Trunk)

### 1. [通俗理解]
双网线“并联”。把两根物理线捆成一根逻辑线，既能提高网速，又能防止其中一根断掉。

### 2. [核心知识点] (填空/简答)
*   **作用**：增加带宽、提高可靠性、负载分担。
*   **模式**：
    1.  **手工负载分担模式 (Manual)**：所有链路都转发。
    2.  **LACP 模式**：通过协议协商，支持活动链路和备份链路（更智能）。
*   **限制条件**：对端设备必须一致；成员接口的**速率、双工模式、物理介质**必须一致。

---

## 五、 三层交换技术

### 1. [核心知识点] (领会/应用)
*   **三层交换机 vs 路由器**：
    *   三层交换机：硬件转发，效率高，主要用于局域网。
    *   路由器：软件转发为主，功能丰富，主要用于网络出口。
*   **VLANIF 接口**：交换机内部创建的虚拟接口。每一个 VLANIF 对应一个 VLAN 的网关 IP。
*   **转发逻辑**：不同 VLAN 通信必须经过三层设备。

---

## 🛠️ 关键配置手册

### 1. VLAN 划分与 Trunk 建立
```shell
vlan batch 10 20                  # 批量创建 VLAN
interface GigabitEthernet0/0/1
 port link-type access
 port default vlan 10
interface GigabitEthernet0/0/24
 port link-type trunk
 port trunk allow-pass vlan all   # 默认华为只允许 VLAN 1 通过，必须手动放行
```

### 2. 链路聚合
```shell
interface Eth-Trunk 1
 trunkport GigabitEthernet 0/0/1 0/0/2
 port link-type trunk
```

### 3. 三层路由 (VLAN 间互访)
```shell
interface Vlanif 10
 ip address 192.168.10.1 24
```

### 4. 生成树优化
```shell
stp mode rstp                     # 开启快速生成树
interface GigabitEthernet 0/0/1
 stp edged-port enable            # 设为边缘端口，PC 上线不需等 30 秒
```
