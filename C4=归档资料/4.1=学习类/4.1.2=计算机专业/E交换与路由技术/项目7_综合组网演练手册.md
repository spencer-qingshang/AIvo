# 项目7：中型企业园区网综合实训手册 (终极实战)

> **核心目标**：从零开始，使用 eNSP 构建一个包含接入层、核心层、无线层和安全出口的完整企业网络。实现全网互通并具备基础安全防护。
> **适用场景**：综合课程设计、期末大作业、自考综合实训。

---

## 一、 环境搭建 (地基)

### 1. eNSP 拓扑描述
*   **接入层 (Access)**: LSW1 (S3700)，连接 PC1 和 PC2。
*   **核心层 (Core)**: CoreSW (S5700)，作为全网网关和 DHCP 服务器。
*   **无线层 (WLAN)**: AC6005 旁挂在 CoreSW 上，管理 AP1。
*   **安全出口 (Security)**: AR1 出口路由器，连接外网 ISP。

### 2. 规划表 (一图胜千言)
| 区域 | VLAN | IP网段 | 网关 (CoreSW) | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| **员工区** | VLAN 10 | 192.168.10.0/24 | 192.168.10.254 | 有线接入 |
| **无线区** | VLAN 20 | 192.168.20.0/24 | 192.168.20.254 | 手机接入 |
| **管理区** | VLAN 100 | 192.168.100.0/24| 192.168.100.254| AP管理 |
| **互联区** | VLAN 800 | 10.1.1.0/24 | 10.1.1.1 | 核心连出口 |
| **外网区** | - | 202.100.1.0/24 | - | 模拟互联网 |

---

## 二、 第一步：基础接入与 VLAN (打通骨架)

### 1. 接入交换机 LSW1
```shell
<Huawei> system-view
[Huawei] sysname LSW1
[LSW1] vlan batch 10 100
[LSW1] interface e0/0/1
[LSW1-Ethernet0/0/1] port link-type access
[LSW1-Ethernet0/0/1] port default vlan 10  # 连PC1
[LSW1] interface e0/0/2
[LSW1-Ethernet0/0/2] port link-type trunk
[LSW1-Ethernet0/0/2] port trunk pvid vlan 100 # 给AP管理流量打标
[LSW1-Ethernet0/0/2] port trunk allow-pass vlan 10 100 # 连AP
[LSW1] interface g0/0/1
[LSW1-GigabitEthernet0/0/1] port link-type trunk
[LSW1-GigabitEthernet0/0/1] port trunk allow-pass vlan 10 100 # 上行连核心
```

### 2. 核心交换机 CoreSW
```shell
<Huawei> system-view
[Huawei] sysname CoreSW
[CoreSW] vlan batch 10 20 100 800
[CoreSW] interface g0/0/1
[CoreSW-GigabitEthernet0/0/1] port link-type trunk
[CoreSW-GigabitEthernet0/0/1] port trunk allow-pass vlan 10 100 # 下连接入
```

---

## 三、 第二步：三层网关与 DHCP (派发地址)

### 1. 配置 VLANIF 接口
```shell
[CoreSW] interface vlanif 10
[CoreSW-Vlanif10] ip address 192.168.10.254 24
[CoreSW] interface vlanif 20
[CoreSW-Vlanif20] ip address 192.168.20.254 24
[CoreSW] interface vlanif 100
[CoreSW-Vlanif100] ip address 192.168.100.254 24
[CoreSW] interface vlanif 800
[CoreSW-Vlanif800] ip address 10.1.1.1 24
```

### 2. 开启 DHCP 服务
```shell
[CoreSW] dhcp enable
[CoreSW] interface vlanif 10
[CoreSW-Vlanif10] dhcp select interface
[CoreSW] interface vlanif 20
[CoreSW-Vlanif20] dhcp select interface
[CoreSW] interface vlanif 100
[CoreSW-Vlanif100] dhcp select interface
[CoreSW-Vlanif100] dhcp server option 43 sub-option 3 ascii 192.168.100.1 # 告诉AP，AC是100.1
```

---

## 四、 第三步：无线业务 (AC/AP配置)

### 1. AC 基础配置
```shell
[AC] vlan 100
[AC] interface vlanif 100
[AC-Vlanif100] ip address 192.168.100.1 24
[AC] capwap source interface vlanif 100
```

### 2. AP 上线与 WIFI 广播
*(简化步骤，详细见项目5手册)*
```shell
[AC-wlan-view] ap-id 0 mac-address <MAC>
[AC-wlan-view] ssid-profile name ssid-corp
[AC-wlan-ssid-prof-ssid-corp] ssid Huawei-Corp
[AC-wlan-view] vap-profile name vap-corp
[AC-wlan-vap-prof-vap-corp] forward-mode direct-forward
[AC-wlan-vap-prof-vap-corp] service-vlan vlan-id 20 (员工无线进VLAN 20)
[AC-wlan-view] ap-group name default
[AC-wlan-view-ap-group-default] vap-profile vap-corp wlan 1 radio all
```

---

## 五、 第四步：出口安全与 NAT (通网)

### 1. 配置静态路由 (内网通出口)
```shell
[CoreSW] ip route-static 0.0.0.0 0 10.1.1.2 # 核心默认指向出口路由
```

### 2. 出口路由器 AR1
```shell
[AR1] interface g0/0/0
[AR1-GigabitEthernet0/0/0] ip address 10.1.1.2 24 # 连核心
[AR1] interface g0/0/1
[AR1-GigabitEthernet0/0/1] ip address 202.100.1.1 24 # 连外网
[AR1] ip route-static 192.168.0.0 16 10.1.1.1 # 回程路由：回内网怎么走
```

### 3. 配置 Easy-IP NAT
```shell
[AR1] acl 2000
[AR1-acl-basic-2000] rule permit source 192.168.0.0 0.0.255.255
[AR1] interface g0/0/1
[AR1-GigabitEthernet0/0/1] nat outbound 2000 # 只要是192.168开头的，全部转成公网IP上网
```

---

## 六、 验证与避坑

### 1. 验证步骤
1.  **PC1**: `ipconfig /renew` 领 IP，然后 `ping 202.100.1.2` (ISP)。
2.  **STA**: 搜 `Huawei-Corp` 连接，看是否领到 `192.168.20.X` 的 IP。
3.  **AC**: `display ap all` 确保 State 是 `nor`。

### 2. 避坑指南 (必看)
*   **AP 离线**：检查核心交换机的 Option 43 有没有写 AC 的地址。
*   **能 Ping 通网关但上不了网**：检查 AR1 路由器的“回程路由”是否配置正确。
*   **VLAN 透传**：确保 LSW1 到 CoreSW 之间的 Trunk 允许了所有业务 VLAN 通过。
