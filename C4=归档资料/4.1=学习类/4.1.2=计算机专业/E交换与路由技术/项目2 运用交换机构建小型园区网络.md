# 项目2：交换技术深度通俗版 (看这一篇就够了)

## 🌟 核心直觉：交换机到底在干什么？
如果路由器是“快递员”（负责跨城市送货），交换机就是“楼层管理员”（负责大楼内部的分发）。

---

## 第一章：VLAN —— 网络里的“虚拟隔断”

### 1.1 为什么要搞 VLAN？ (问题背景)
**没有 VLAN 的世界**：
想象一个大办公室，所有人都在一个房间。某个人大喊一声“谁有订书机？”，房间里 100 个人都会被打断。如果这 100 个人都在大喊大叫，办公室就没法工作了。这在网络里叫**“广播风暴”**。

**有了 VLAN 的世界**：
我们用“隐形的隔音墙”把办公室分成了【财务部】、【技术部】。财务部大喊，只有财务部能听见。这就是**隔离广播域**。

### 1.2 VLAN 标签 (802.1Q) —— 数据的“身份证”
*   数据在交换机内部跑的时候，会被贴上一个小标签（Tag），写着它属于哪个部门。
*   **考试必考**：这个标签长 **4个字节**，标准的代号是 **802.1Q**。

---

## 第二章：Access 与 Trunk —— 门口的“保安规则”

这是很多同学最晕的地方，我们用**“电梯”**来类比：

### 2.1 Access 接口 (就像部门的小门)
*   **连接对象**：电脑、打印机。
*   **规则**：这个门只属于一个部门（比如 VLAN 10）。
*   **入场**：电脑发出的数据是“裸奔”的。数据进入这个门，保安（交换机）立刻给它贴上“VLAN 10”的标签。
*   **出场**：数据要发给电脑时，保安会**撕掉标签**。因为电脑不认识 VLAN 标签。

### 2.2 Trunk 接口 (就像公共大电梯)
*   **连接对象**：另一台交换机。
*   **规则**：为了省事，我们不能在两台交换机之间连 100 根线。我们只连一根线，但允许所有部门的数据通过。
*   **入场/出场**：数据过电梯时，**必须带着标签**。保安看一眼标签上的“VLAN ID”，就知道它是哪个部门的，该送到对面的哪个房间。

---

## 第三章：STP 生成树协议 —— 防止“鬼打墙”

### 3.1 环路的恐怖 (为什么需要它)
如果你不小心把一根网线的两头都插在同一个交换机上，或者三台交换机连成了一个圈。一个广播包就会在圈子里无限循环，速度极快，1秒钟就能把交换机CPU烧到100%。

### 3.2 STP 的解决办法
STP 就像一个**智能交警**。它会自动发现网络里的“圈子”，然后**逻辑上锁死**其中的一个路口（阻塞端口）。
*   **平时**：路不通，没有环路。
*   **出事时**：如果主路断了，交警立刻把锁打开，让备用路通车。

### 3.3 选举规则 (考试高频)
就像选班长：
1.  **选根桥 (班长)**：看谁的“桥ID”小。
    *   桥ID = 优先级 + MAC地址。
    *   **优先级默认 32768**。如果你想让某台设备当班长，就把它的优先级改成 4096。
2.  **根端口/指定端口**：大家都找离班长最近的路。

---

## 第四章：三层交换 —— 内部的“传达室”

### 4.1 尴尬的情况
划了 VLAN 后，财务部和技术部彻底听不见对方说话了。但如果财务部确实要发报销单给技术部怎么办？

### 4.2 三层交换机的救场
普通交换机（二层）只认 MAC 地址。**三层交换机** 相当于在交换机内部装了一个简易版路由器。
*   它能创建 **VLANIF 接口**。
*   **VLANIF 10 的 IP** 就是 VLAN 10 那些电脑的“网关”。
*   电脑把报销单发给网关，网关在内部直接转交给 VLAN 20。

---

## 第五章：链路聚合 (Eth-Trunk) —— 团结力量大

### 5.1 直观理解
一根网线只有 1Gbps 的速度，不够用怎么办？
我们拿两根或者四根网线，把它们**“捆”**在一起，当成一根用。
*   **好处**：速度加倍；一根断了，另一根顶上，网络不断。

---

## 🛠️ 实验命令小抄 (对照原理看)

1.  **创建 VLAN**：`vlan 10`
2.  **配 Access**：
    *   `port link-type access` (定性质：这是部门小门)
    *   `port default vlan 10` (定归属：属于 10 部门)
3.  **配 Trunk**：
    *   `port link-type trunk` (定性质：这是大电梯)
    *   `port trunk allow-pass vlan all` (定规则：谁都能上电梯)
4.  **配三层网关**：
    *   `interface vlanif 10`
    *   `ip address 192.168.10.1 24` (这是全村人的出口)
