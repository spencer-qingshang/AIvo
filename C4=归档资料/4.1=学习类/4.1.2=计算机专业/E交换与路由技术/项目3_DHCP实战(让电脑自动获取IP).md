# 项目3实战：DHCP 服务 (自动获取 IP)

> **实验目标**：在路由器 R1 上开启 DHCP 服务，使 PC1 能够通过自动获取的方式得到 IP 地址、子网掩码和网关。
> **适用场景**：公司内部有大量员工电脑，手动配 IP 太慢且容易出错时。

---

## 一、 DHCP 原理大白话
DHCP (动态主机配置协议) 就像是**“发号员”**。
1. **电脑**：开机喊一句：“谁能给我个 IP ？” (DHCP Discover)
2. **路由器**：回答：“我有！给你这个 192.168.10.5 怎么样？” (DHCP Offer)
3. **电脑**：确认：“好嘞，我就要这个了！” (DHCP Request)
4. **路由器**：拍板：“行，给你登记上了，你拿去用吧。” (DHCP Ack)

---

## 二、 核心配置步骤 (在 R1 上进行)

> **注意**：我们使用最简单的 **“接口模式”**。即：路由器哪个接口接了电脑，就从哪个接口对应的网段发 IP。

### 1. 开启 DHCP 总开关
```shell
<R1> system-view
[R1] dhcp enable
```

### 2. 在连接 PC1 的接口下开启服务
我们之前确认过，PC1 连在 R1 的 `GE 0/0/1` 接口。
```shell
[R1] interface GigabitEthernet 0/0/1
[R1-GigabitEthernet0/0/1] dhcp select interface    # 告诉接口：从你自己身上发IP
[R1-GigabitEthernet0/0/1] dhcp server dns-list 114.114.114.114  # 给电脑发个DNS(上网查名用)
[R1-GigabitEthernet0/0/1] dhcp server excluded-ip-address 192.168.10.250 192.168.10.253
# 上面这行是可选的：保留几个IP不发出去，留给服务器用。
```

---

## 三、 PC 端的操作 (见证效果)

1. **双击 PC1**。
2. 在 `基础配置` 选项卡中，找到 `IPv4配置`。
3. 把原来的 `静态` (Static) 勾选切换为 **`DHCP`**。
4. **务必点击右下角的“应用”按钮！**
5. 点击 PC1 窗口顶部的 **`命令行`** 选项卡。

### 验证命令：
在 PC1 的命令行输入：
`ipconfig`

**预期结果**：
你应该能看到 PC1 自动获得了一个 `192.168.10.x` 的 IP 地址，且网关自动变为了 `192.168.10.254`。

---

## 四、 常见问题解析 (笔记)

*   **Q：为什么我改了 DHCP 还是没 IP (显示 0.0.0.0)？**
    *   **A1**：检查 R1 的 `dhcp enable` 敲了没？
    *   **A2**：检查 R1 对应的接口（GE0/0/1）是否配了 IP 地址？(DHCP 必须知道自己属于哪个网段才能发 IP)。
    *   **A3**：点一下 PC 窗口里的“应用”按钮，然后等几秒，或者输入 `ipconfig /renew` (虽然eNSP PC不支持renew，通常重新点应用即可)。

*   **Q：DNS 是干什么的？**
    *   **A1**：它是域名解析。没有它，电脑能 Ping 通 IP，但打不开 www.baidu.com。`114.114.114.114` 是国内常用的公共 DNS。
