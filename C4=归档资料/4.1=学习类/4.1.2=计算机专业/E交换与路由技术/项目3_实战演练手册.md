# 项目3：路由器实战演练手册 (静态路由 + OSPF)

> **核心目标**：通过3台路由器连接两台PC，分别使用“静态路由”和“OSPF”实现全网互通。
> **适用场景**：eNSP模拟器，AR2220路由器。

---

## 一、 环境搭建 (避坑必读)

### 1. 物理拓扑
**严禁使用 Auto 自动连线！** 请使用 `Copper` (铜轴线) 手动连接，确保端口一一对应。

| 起点 | 接口 | ----> | 终点 | 接口 | 说明 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **PC1** | Eth 0/0/1 | --> | **R1** | **GE 0/0/1** | 北京用户接入 |
| **R1** | **GE 0/0/0** | --> | **R2** | **GE 0/0/0** | R1-R2 骨干互联 |
| **R2** | **GE 0/0/1** | --> | **R3** | **GE 0/0/0** | R2-R3 骨干互联 |
| **R3** | **GE 0/0/1** | --> | **PC2** | Eth 0/0/1 | 广州用户接入 |

### 2. IP地址规划
*   **PC1 网段**: 192.168.10.0/24 (网关 .254)
*   **R1-R2 互联**: 12.1.1.0/24 (R1用.1, R2用.2)
*   **R2-R3 互联**: 23.1.1.0/24 (R2用.2, R3用.3)
*   **PC2 网段**: 192.168.20.0/24 (网关 .254)

---

## 二、 基础配置 (地基)

### 1. PC端设置
*   **PC1**: IP `192.168.10.1`, 掩码 `255.255.255.0`, 网关 `192.168.10.254`。
*   **PC2**: IP `192.168.20.1`, 掩码 `255.255.255.0`, 网关 `192.168.20.254`。
*   *注意：配置完必须点右下角“应用”。*

### 2. 路由器接口IP配置
```shell
# R1 配置
[R1] interface g0/0/1
[R1-g0/0/1] ip address 192.168.10.254 24
[R1-g0/0/1] interface g0/0/0
[R1-g0/0/0] ip address 12.1.1.1 24

# R2 配置
[R2] interface g0/0/0
[R2-g0/0/0] ip address 12.1.1.2 24
[R2-g0/0/0] interface g0/0/1
[R2-g0/0/1] ip address 23.1.1.2 24

# R3 配置
[R3] interface g0/0/0
[R3-g0/0/0] ip address 23.1.1.3 24
[R3-g0/0/0] interface g0/0/1
[R3-g0/0/1] ip address 192.168.20.254 24
```
*   **阶段检查**：此时 PC1 应该能 Ping 通 R1 (192.168.10.254)，PC2 能 Ping 通 R3。如果直连都不通，检查VirtualBox注册或WinPcap。

---

## 三、 实战一：静态路由 (手工指路)

### 1. 配置逻辑
*   **R1**：想去 20.0 网段，下一跳给 R2 (12.1.1.2)。
*   **R2**：想去 10.0 网段找 R1 (12.1.1.1)；想去 20.0 网段找 R3 (23.1.1.3)。
*   **R3**：想去 10.0 网段，下一跳给 R2 (23.1.1.2)。

### 2. 命令实现
```shell
# R1
[R1] ip route-static 192.168.20.0 24 12.1.1.2

# R2 (关键：作为中间人，两头都要指)
[R2] ip route-static 192.168.10.0 24 12.1.1.1
[R2] ip route-static 192.168.20.0 24 23.1.1.3

# R3 (关键：要有回程路由，否则包有去无回)
[R3] ip route-static 192.168.10.0 24 23.1.1.2
```

### 3. 故障排查经验 (实战总结)
*   **现象**：`Destination host unreachable` (目标主机不可达)。
    *   **排查**：这通常是你自己的网关没通。检查PC网关设置，检查物理连线。
*   **现象**：`Request timeout` (请求超时)。
    *   **排查**：这通常是包发出去了，但回不来。检查 R3 是否配置了回程路由？R2 是否两边都有路由？

---

## 四、 实战二：OSPF (自动导航)

### 1. 清理环境 (拆旧)
在配置OSPF前，**必须**删除刚才的静态路由，否则实验效果会被覆盖。
```shell
[R1] undo ip route-static 192.168.20.0 24 12.1.1.2
# R2, R3 同理，把 ip route-static 命令前加 undo 删掉。
```
*   **检查**：此时 Ping 应该**不通**了。

### 2. OSPF 配置 (建新)
**核心逻辑**：我有哪个网段，我就 network 哪个网段。

**R1 配置 (宣告 10.0 和 12.0)**
```shell
[R1] ospf 1 router-id 1.1.1.1
[R1-ospf-1] area 0
[R1-ospf-1-area-0.0.0.0] network 192.168.10.0 0.0.0.255  # 注意是反掩码
[R1-ospf-1-area-0.0.0.0] network 12.1.1.0 0.0.0.255
```

**R2 配置 (宣告 12.0 和 23.0)**
```shell
[R2] ospf 1 router-id 2.2.2.2
[R2-ospf-1] area 0
[R2-ospf-1-area-0.0.0.0] network 12.1.1.0 0.0.0.255
[R2-ospf-1-area-0.0.0.0] network 23.1.1.0 0.0.0.255
```
*   *提示：敲完这里，R1 和 R2 会建立邻居关系 (Full 状态)。*

**R3 配置 (宣告 23.0 和 20.0)**
```shell
[R3] ospf 1 router-id 3.3.3.3
[R3-ospf-1] area 0
[R3-ospf-1-area-0.0.0.0] network 23.1.1.0 0.0.0.255
[R3-ospf-1-area-0.0.0.0] network 192.168.20.0 0.0.0.255
```

### 3. 验证
1.  **查路由表**：`display ip routing-table`。看到 `OSPF` 字样的路由条目，说明自动学习成功。
2.  **Ping测试**：PC1 Ping PC2，应直接连通。