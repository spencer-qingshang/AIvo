# 项目2-3：交换与路由核心基础概念深度汇总

## 1. VLAN Tag (VLAN 标签)
- **是什么 (What)**：它是在原始以太网数据帧中增加的一个 **4字节** 的字段（基于 IEEE 802.1Q 标准）。最关键的部分是 **VLAN ID**（12位），用于标识这个数据包属于哪个 VLAN。
- **为什么 (Why)**：在交换机互连的链路（Trunk）上，会同时跑好几个部门（VLAN）的数据。如果没有这个标签，对端的交换机就不知道该把收到的数据分发给哪个部门。它是为了在物理连线上实现“逻辑隔离”。
- **怎么做 (How)**：
    - **打标签 (Tagging)**：当数据进入交换机（Access口进入）时，交换机会根据端口所属 VLAN 给它贴上标签。
    - **去标签 (Untagging)**：当数据离开交换机去往电脑（从Access口出）时，交换机会把标签撕掉，因为电脑网卡通常不认识 Tag。
    - **透传 (Passing)**：在 Trunk 链路上，标签被保留，直接传输。

## 2. 链路类型 (Link Type) 与端口角色
- **是什么 (What)**：
    - **Access 端口**：只能属于一个 VLAN，通常连接终端设备（PC、服务器）。
    - **Trunk 端口**：可以允许多个 VLAN 通过，通常连接网络设备（交换机与交换机、交换机与路由器）。
- **为什么 (Why)**：
    - **Access**：保证用户终端只能在自己的 VLAN 内通信，且不接收复杂的 VLAN 标签信息。
    - **Trunk**：通过一根物理线缆传输所有 VLAN 的数据，节省硬件成本。
- **怎么做 (How)**：
    - **Access 配置**：`port link-type access` -> `port default vlan 10`
    - **Trunk 配置**：`port link-type trunk` -> `port trunk allow-pass vlan all`

## 3. 端口双工模式 (Port Duplex Mode)
- **是什么 (What)**：
    - **半双工 (Half-duplex)**：同一时刻只能发或只能收（类似对讲机）。
    - **全双工 (Full-duplex)**：同一时刻可以同时发和收（类似电话）。
- **为什么 (Why)**：全双工彻底解决了网络碰撞（Collision）问题，传输速率翻倍。现在的交换机默认都是全双工或自动协商（Auto）。如果两端双工模式不匹配，会导致严重的丢包和网络延迟。
- **怎么做 (How)**：
    - `interface GigabitEthernet 0/0/1`
    - `duplex full` (强制全双工) 或 `duplex auto` (自动协商)

## 4. STP / RSTP (生成树协议)
- **是什么 (What)**：一种用于防止二层网络环路的协议。STP（802.1D）是基础版，RSTP（802.1w，快速生成树）是它的改进版。
- **为什么 (Why)**：
    - **为什么要冗余？** 为了怕断线。
    - **为什么要 STP？** 物理上连成环后会产生“广播风暴”，让网络瞬间瘫痪。STP 会自动计算并“逻辑阻塞”掉其中一条路。当主路断开时，阻塞的路会自动接通。
- **怎么做 (How)**：
    - 全局开启：`stp enable`
    - 设置模式：`stp mode rstp`

## 5. 三层交换机 (L3 Switch) vs 路由器 (Router)
- **是什么 (What)**：
    - **三层交换机**：带有路由功能的交换机。它不仅能看 MAC 地址（二层），还能看 IP 地址（三层）。
    - **路由器**：专门用于网络互连的设备。
- **为什么 (Why)**：
    - **为什么要三层？** 二层交换机只能在同一个 VLAN 转发，不同 VLAN 无法互通。为了让研发部（VLAN 10）能访问市场部（VLAN 20），必须有三层转发设备作为“翻译官”（网关）。
    - **区别在哪？** 
        - **性能**：三层交换机靠硬件（ASIC芯片）转发，在局域网内极快。
        - **接口类型**：路由器支持 WAN 接口（串口、广域网卡），适合连外网；三层交换机全是太网口，适合内网。
- **怎么做 (How)**：
    - **三层交换机**：通过配置逻辑接口实现 `interface Vlanif 10` -> `ip address 192.168.10.1 24`。
    - **路由器**：直接在物理接口配置 IP。

## 6. 核心逻辑总结：转发依据
- **二层转发（交换机）**：根据 **MAC 地址表**。
- **三层转发（路由器/三层交换机）**：根据 **路由表**。
