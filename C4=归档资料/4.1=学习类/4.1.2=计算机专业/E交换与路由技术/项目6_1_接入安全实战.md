# 项目6-1：交换机接入安全实战手册

> **核心目标**：配置交换机端口安全，只允许指定电脑上网；配置 Telnet 远程管理，让管理员能躺在椅子上修设备。
> **场景**：LSW1 是接入交换机，连接 PC1（好人）和 PC2（坏人）。

---

## 一、 环境准备 (手把手搭拓扑)

### 1. 拖动设备
请在 eNSP 左侧工具栏中找到以下设备并拖入画布：
*   **交换机 (Switch)**：选择 **S5700** (或者 S3700 均可)，拖入 1 台，重命名为 `LSW1`。
*   **终端 (End Device)**：选择 **PC**，拖入 2 台，分别重命名为 `PC1` 和 `PC2`。

### 2. 物理连线 (Copper 铜线)
请使用 **Copper (铜轴线)** 进行连接，**注意接口不能插错**：
1.  **PC1** 的 `Ethernet 0/0/1` 接口 <--> 连接到 **LSW1** 的 `GE 0/0/1` 接口。
    *   *说明*：这是“合法员工”的接口。
2.  **PC2** 的 `Ethernet 0/0/1` 接口 <--> 连接到 **LSW1** 的 `GE 0/0/2` 接口。
    *   *说明*：这是“黑客/非法接入者”的接口。

### 3. 开机
选中所有设备，点击工具栏上的 **启动 (Start)** 按钮。等待设备变绿。

### 4. 第一步：配置终端 IP (PC 端)
> **注意**：eNSP 的 PC 是图形化配置。
1.  **双击 PC1** (员工)：
    *   IPv4地址：`192.168.1.1`
    *   子网掩码：`255.255.255.0`
    *   网关：`192.168.1.254`
    *   点击 **应用**。
2.  **双击 PC2** (黑客)：
    *   IPv4地址：`192.168.1.2`
    *   子网掩码：`255.255.255.0`
    *   网关：`192.168.1.254`
    *   点击 **应用**。

### 5. 第二步：配置交换机管理 IP (LSW1)
如果不配这个 IP，交换机自己就没有地址，没法被远程管理。
```shell
<Huawei> system-view
[Huawei] sysname LSW1

# 进入 Vlanif 1 (默认的管理接口)
[LSW1] interface vlanif 1
[LSW1-Vlanif1] ip address 192.168.1.254 24
# 大白话：给交换机自己起个名（网关地址）。
[LSW1-Vlanif1] quit
```

### 6. 连通性自测
*   打开 **PC1** 的命令行 (Command)。
*   输入 `ping 192.168.1.254`。
*   **必须通**。如果不通，后面做端口安全也没意义。

---

## 二、 端口安全实战 (只认熟脸)

### 1. 开启端口安全
```shell
[LSW1] interface g0/0/1
[LSW1-GigabitEthernet0/0/1] port-security enable
# 大白话：在这个接口上开启“安保模式”。
```

### 2. 配置 Sticky MAC (懒人模式)
```shell
[LSW1-GigabitEthernet0/0/1] port-security mac-address sticky
# 大白话：开启“粘性记录”功能。交换机会自动记住第一个连上来的 MAC 地址，并把它当成唯一的合法用户。
[LSW1-GigabitEthernet0/0/1] port-security max-mac-num 1
# 大白话：这个接口最多只允许 1 个设备通过。多了就报警。
[LSW1-GigabitEthernet0/0/1] port-security protect-action shutdown
# 大白话：如果发现非法设备（MAC 不对），直接把接口“shutdown”（关掉）。这是最狠的惩罚。
```

### 3. 验证
*   让 PC1 ping 网关 `192.168.1.254`，**能通**。此时交换机已经记住了 PC1 的 MAC。
*   **模拟攻击**：拔掉 PC1 的线，把 PC2 的线插到 `GE 0/0/1` 接口上。
*   让 PC2 ping 网关。
*   **结果**：PC2 一发包，LSW1 的 `GE 0/0/1` 接口指示灯立马**变红 (Shutdown)**。
*   **恢复方法**：管理员手动在接口下输 `undo shutdown`。

---

## 三、 远程管理实战 (Telnet + AAA)

### 1. 配置 AAA 认证 (创建账号)
```shell
[LSW1] aaa
[LSW1-aaa] local-user admin password cipher huawei@123
# 大白话：创建一个本地用户叫 admin，密码是 huawei@123（加密存储）。
[LSW1-aaa] local-user admin privilege level 15
# 大白话：给 admin 最高权限（15级），也就是什么都能干。
[LSW1-aaa] local-user admin service-type telnet
# 大白话：规定 admin 这个账号只能用来登录 Telnet，不能干别的。
[LSW1-aaa] quit
```

### 2. 开启 Telnet 服务通道 (VTY)
```shell
[LSW1] user-interface vty 0 4
# 大白话：打开 0 到 4 号共 5 个虚拟通道，允许 5 个人同时远程登录。
[LSW1-ui-vty0-4] authentication-mode aaa
# 大白话：进门的时候，必须用 AAA 那套流程（查账号密码）来验证身份。
[LSW1-ui-vty0-4] quit
```

### 3. 验证 (避坑指南)

> **注意**：eNSP 中的“PC”节点命令行极其精简，**不支持** `telnet` 命令（输入会报 `Invalid command!`）。

**推荐验证方案：**
*   **方案 A (最专业)**：将拓扑中的 **PC1** 换成一台 **Router (路由器)**。给路由器接口配置 IP `192.168.1.1` 后，在路由器上执行 `telnet 192.168.1.254`。
*   **方案 B (最快速)**：直接在 **LSW1** 的命令行输入 `telnet 127.0.0.1`（或者 `telnet 192.168.1.254`）。
    *   输入用户名 `admin`，密码 `huawei@123`。
    *   只要能弹出登录提示并进入 `<LSW1>` 界面，说明交换机端的 Telnet/AAA 配置已成功。

### 4. 专业命令验证 (不只是Ping)
*   **查看端口安全状态**：
    ```shell
    [LSW1] display port-security interface g0/0/1
    ```
    *   查看 `Port Security Enable` 是否为 `Enable`。
    *   查看 `Protect Action` 是否为 `Shutdown`。
*   **查看当前登录用户**：
    ```shell
    [LSW1] display users
    ```

---

## 四、 保存配置 (必做!)

**非常重要**：在真实设备上，如果不保存，断电后配置就丢了。
```shell
<LSW1> save
The current configuration will be written to the device.
Are you sure to continue? [Y/N] y
Info: Please input the file name ( *.cfg, *.zip ) [vrpcfg.zip]: (直接回车)
```