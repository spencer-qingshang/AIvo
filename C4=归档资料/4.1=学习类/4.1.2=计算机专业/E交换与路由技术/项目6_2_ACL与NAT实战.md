# 项目6-2：路由器流量控制与NAT实战手册

> **核心目标**：用 ACL 禁止某个部门上网，用 NAT 让全公司通过一个公网 IP 上网。
> **场景**：AR1 是公司出口路由器，连接内网和互联网（ISP）。

---

## 一、 环境准备

### 1. 拓扑
*   **AR1**: 企业出口路由器。
*   **PC1**: 经理（192.168.1.10）。
*   **PC2**: 员工（192.168.1.20）。
*   **ISP**: 模拟互联网的路由器（202.100.1.2）。

### 2. 规划表
| 接口 | IP地址 | 说明 |
| :--- | :--- | :--- |
| AR1 G0/0/0 (内网) | 192.168.1.254/24 | 内网网关 |
| AR1 G0/0/1 (外网) | 202.100.1.1/24 | 公网接口 |

---

## 二、 ACL 实战 (门禁卡)

### 1. 基本 ACL (禁止员工上网)
```shell
[AR1] acl 2000
[AR1-acl-basic-2000] rule deny source 192.168.1.20 0
# 大白话：拒绝源 IP 是 192.168.1.20 (PC2) 的流量。
[AR1-acl-basic-2000] rule permit source any
# 大白话：除了上面拒绝的，其他人（any）都允许通过。
[AR1-acl-basic-2000] quit
```

### 2. 应用 ACL
```shell
[AR1] interface g0/0/0
[AR1-GigabitEthernet0/0/0] traffic-filter inbound acl 2000
# 大白话：在内网接口的“入口”处安检。只要数据包一进路由器，先查 ACL 2000。
```

---

## 三、 NAT 实战 (Easy-IP)

### 1. 定义允许 NAT 的流量 (ACL)
```shell
[AR1] acl 2001
[AR1-acl-basic-2001] rule permit source 192.168.1.0 0.0.0.255
# 大白话：定义一张白名单，允许 192.168.1.X 网段的所有人做 NAT 转换。
[AR1-acl-basic-2001] quit
```

### 2. 配置 Easy-IP (出海口)
```shell
[AR1] interface g0/0/1
[AR1-GigabitEthernet0/0/1] nat outbound 2001
# 大白话：在这个公网接口上开启 NAT。只要是 ACL 2001 里的人想出去，统统把源 IP 换成这个接口的公网 IP (202.100.1.1)。
```

### 3. 配置默认路由 (指路牌)
```shell
[AR1] ip route-static 0.0.0.0 0 202.100.1.2
# 大白话：所有要去互联网的数据包，都扔给 ISP (202.100.1.2)。
```

---

## 四、 验证

1.  **ACL 验证**：
    *   PC1 ping ISP (202.100.1.2) -> **通**。
    *   PC2 ping ISP -> **不通** (被 ACL 2000 拦住了)。
2.  **NAT 验证**：
    *   在 ISP 上抓包 (G0/0/0)。
    *   PC1 ping ISP。
    *   抓包看到的源 IP 应该是 **202.100.1.1** (公网IP)，而不是 192.168.1.10。说明 NAT 转换成功。
