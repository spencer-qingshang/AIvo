# 项目3 运用路由器构建中型园区网络

> **写在前面**：本章内容非常核心。路由器是互联网的枢纽，请按照以下8个任务的顺序循序渐进。

---

## 1. 模拟器中路由器的配置

### 1.1 识记
*   **Console端口登录管理**：
    *   **概念**：新买回来的路由器里面是空的，没有IP地址，无法远程连接。必须用一根专用的“Console线”（控制线），一头插电脑USB/串口，一头插路由器Console口，进行第一次配置。
    *   **在eNSP中**：虽然我们是双击图标进入命令行，但本质上模拟的就是Console连接。
    *   **密码设置**：为了安全，通常会给Console口设密码（命令：`user-interface console 0` -> `authentication-mode password`）。
*   **路由器命令视图模式**：
    *   `<Huawei>` **用户视图**：只能看，不能改。
    *   `[Huawei]` **系统视图**：全局修改（改名、通过）。
    *   `[Huawei-G0/0/0]` **接口视图**：修改具体网口。

### 1.2 领会
*   **路由器端口类型**：
    *   **Ethernet (E)**：百兆口（旧设备常见）。
    *   **GigabitEthernet (GE)**：千兆口（目前主流）。
    *   **Serial (S)**：串口（广域网连接，eNSP中AR2220需要手动添加模块才有）。
*   **路由器添加模块**：
    *   **场景**：接口不够用了，或者需要特殊的串口。
    *   **操作**：右键点击路由 -> `设置` -> 视图中把卡片拖到卡槽里 -> **必须先关机才能加模块！**
*   **路由器端口命名规则**：
    *   例如 `GE 0/0/1`：
        *   第1个0：槽位号（板卡位置）。
        *   第2个0：子卡号。
        *   第3个1：具体的接口编号。

### 1.3 应用：熟练在路由器不同端口间进行切换
*   **操作演练**：
    ```shell
    <Huawei> system-view
    [Huawei] interface GigabitEthernet 0/0/0     # 进入0号口
    [Huawei-GigabitEthernet0/0/0] quit           # 退出来
    [Huawei] interface GigabitEthernet 0/0/1     # 进入1号口
    ```

---

## 2. 路由器的基本配置

### 2.1 识记
*   **认识路由器**：它工作在OSI模型的**第三层（网络层）**，依靠**IP地址**寻址。
*   **模块与端口表示**：`Slot/Subslot/Port` (槽/子卡/端口)。

### 2.2 领会
*   **路由器的工作原理**：收到数据包 -> 拆开看目标IP -> 查路由表（地图） -> 找到出口 -> 转发。如果查不到，直接丢弃。
*   **作用**：连接不同的网络（如连接局域网和互联网），隔离广播风暴。

### 2.3 应用：路由器基本命令应用
*   **任务**：给路由器改名并配IP。
    ```shell
    [Huawei] sysname R1                          # 改名
    [R1] interface g0/0/0                        # 进接口
    [R1-GigabitEthernet0/0/0] ip address 192.168.1.1 24  # 配IP和掩码
    [R1-GigabitEthernet0/0/0] display this       # 查看当前接口配置
    ```

---

## 3. 实现部门计算机动态获取地址 (DHCP)

### 3.1 识记
*   **DHCP**：动态主机配置协议 (Dynamic Host Configuration Protocol)。
*   **端口地址池**：接口下挂什么网段，就分什么IP（简单，推荐）。
*   **全局地址池**：建立一个独立的池子，可以灵活分配给不同接口。

### 3.2 领会
*   **DHCP的作用**：自动分配IP地址、子网掩码、网关、DNS服务器地址，避免人工配置错误。

### 3.3 应用：实现DHCP的2种方法

#### 方法A：接口地址池 (最常用)
```shell
[R1] dhcp enable                          # 1. 开启总开关
[R1] interface g0/0/0
[R1-G0/0/0] ip address 192.168.10.1 24    # 2. 接口必须先有IP
[R1-G0/0/0] dhcp select interface         # 3. 开启接口分配模式
[R1-G0/0/0] dhcp server dns-list 8.8.8.8  # 4. 指定DNS
```

#### 方法B：全局地址池 (稍复杂)
```shell
[R1] dhcp enable
[R1] ip pool MyPool                       # 1. 创建池子名叫 MyPool
[R1-ip-pool-MyPool] network 192.168.20.0 mask 24  # 2. 定义网段
[R1-ip-pool-MyPool] gateway-list 192.168.20.1     # 3. 定义网关
[R1-ip-pool-MyPool] quit
[R1] interface g0/0/1
[R1-G0/0/1] ip address 192.168.20.1 24
[R1-G0/0/1] dhcp select global            # 4. 告诉接口去全局池子里拿
```

---

## 4. 利用单臂路由实现部门间网络互访

### 4.1 识记
*   **单臂路由**：用路由器的一个物理接口，通过逻辑分割，处理多个VLAN的数据。
*   **ARP广播**：地址解析协议，问“谁是192.168.1.1？”。

### 4.2 领会
*   **单臂路由原理**：物理接口必须连接到交换机的**Trunk**口。路由器侧创建**子接口**（Sub-interface），每个子接口对应一个VLAN Tag。
*   **ARP广播的作用**：在子接口上开启ARP广播，是为了让路由器能响应VLAN内的ARP请求，否则通信会断。

### 4.3 应用：单臂路由配置
*   **前提**：交换机侧连接路由器的接口已配置为 `Trunk` 并允许 VLAN 10, 20 通过。
*   **路由器配置**：
    ```shell
    [R1] interface g0/0/0.10                # 创建子接口 .10
    [R1-G0/0/0.10] dot1q termination vid 10 # 剥离/封装 VLAN 10 标签
    [R1-G0/0/0.10] ip address 192.168.10.1 24
    [R1-G0/0/0.10] arp broadcast enable     # 【关键】开启ARP广播
    [R1-G0/0/0.10] quit
    # 接着配置 .20 接口同理
    ```

---

## 5. 使用静态路由实现网络连通

### 5.1 识记
*   **静态路由**：管理员手动一条条敲进去的路由信息。
*   **路由表**：命令 `display ip routing-table` 查看。

### 5.2 领会
*   **原理**：指哪打哪。明确告诉路由器“要去目标网段X，下一跳给IP Y”。
*   **特点**：稳定，占用资源少，但网络拓扑变化时需要人工重新配。

### 5.3 应用：静态路由配置
*   **场景**：R1 连接 R2。R1想访问 R2 背后的 192.168.5.0 网段。
*   **命令**：
    ```shell
    # ip route-static [目标网段] [掩码] [下一跳地址]
    [R1] ip route-static 192.168.5.0 24 10.0.0.2
    ```
*   **故障分析**：如果Ping不通，查看路由表 `display ip routing-table`，看有没有这就话。如果有但还不通，检查**回程路由**（对方有没有配回来的路）。

---

## 6. 使用默认路由及浮动路由实现网络连通

### 6.1 识记
*   **默认路由 (缺省路由)**：目标是 `0.0.0.0 0.0.0.0`，代表“所有其他不认识的地方”。
*   **浮动路由**：起到**备份**作用的路由。平时不生效，主路由断了才生效。

### 6.2 领会
*   **浮动路由原理**：利用**优先级 (Preference)**。静态路由默认优先级是60。如果配置一条优先级为100的路由，正常情况下路由器会忽略它（选优先级数值小的）。只有当主路由断了，这条“备胎”才会浮现出来。

### 6.3 应用：配置
*   **默认路由**：
    ```shell
    [R1] ip route-static 0.0.0.0 0 10.0.0.2  # 也就是“上网”的路由
    ```
*   **浮动路由 (备份链路)**：
    ```shell
    # 主线路 (默认优先级60)
    [R1] ip route-static 192.168.5.0 24 10.1.1.2
    # 备线路 (手动设优先级为80，80>60，所以平时不生效)
    [R1] ip route-static 192.168.5.0 24 10.2.2.2 preference 80
    ```

---

## 7. 使用动态路由RIPv2协议实现网络连通

### 7.1 识记
*   **RIP**：路由信息协议 (Routing Information Protocol)，一种古老的协议。
*   **RIPv2**：支持VLSM（可变长子网掩码），支持认证，以组播方式更新。
*   **定时器**：每30秒发一次更新包。

### 7.2 领会
*   **原理**：基于距离矢量（Distance Vector）。以“跳数”（经过几个路由器）来衡量距离，超过15跳不可达。
*   **v1与v2区别**：v1广播更新，不带掩码（不支持子网划分）；v2组播更新，带掩码。

### 7.3 应用：RIPv2配置
```shell
[R1] rip 1                   # 启动RIP进程1
[R1-rip-1] version 2         # 强制使用版本2
[R1-rip-1] network 192.168.1.0  # 宣告直连网段 (注意：RIP只能宣告A/B/C类主网号)
[R1-rip-1] network 10.0.0.0
```

---

## 8. 使用动态路由OSPF协议实现网络连通

### 8.1 识记
*   **OSPF**：开放式最短路径优先 (Open Shortest Path First)。
*   **区域 (Area)**：OSPF为了管理大网络，把网络划分成区。**Area 0** 是骨干区域，所有其他区域必须连着它。

### 8.2 领会
*   **原理**：链路状态（Link State）。每个路由器都画出一张完整的网络拓扑图，然后用SPF算法算出最近的路。比RIP更智能、收敛更快。

### 8.3 应用：OSPF单区域配置
*   **任务**：将R1加入OSPF区域0。
    ```shell
    [R1] ospf 1 router-id 1.1.1.1          # 启动并设置身份证号
    [R1-ospf-1] area 0                     # 进入骨干区域
    [R1-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255  # 精确宣告
    # 注意：OSPF宣告用的是“反掩码”（通配符掩码），0代表必须匹配，255代表随意。
    ```