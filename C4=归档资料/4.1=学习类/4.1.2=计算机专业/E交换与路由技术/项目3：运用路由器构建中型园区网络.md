# 项目3：运用路由器构建中型园区网络

## 0. 章节概览
> 本章重点：理解路由器工作原理、功能及效果；熟练掌握配置命令；具备初步故障分析方法；区分路由器与三层交换机。
> 本章难点：熟悉各项功能及路由协议的配置命令与工作原理；设计并配置中型园区网络。

---

## 1. 模拟器中路由器的配置
### 1.1 识记
- **Console 端口登录管理：** 
  - 路由器是“DCE”（数据通信设备），PC 是“DTE”（数据终端设备）。
  - 连接方式：通过反转线（Rollover Cable）连接 PC 的串口（RS-232）与路由器的 Console 端口。
  - 终端参数：波特率 9600 bps，无校验，1位停止位，无流控。
- **路由器命令视图模式：**
  - **用户视图（User View）：** `<Huawei>`，仅查看简单信息。
  - **系统视图（System View）：** `[Huawei]`，配置全局参数（执行 `system-view`）。
  - **接口视图（Interface View）：** `[Huawei-GigabitEthernet0/0/0]`，配置接口（执行 `interface <type> <number>`）。
  - **协议视图（Protocol View）：** `[Huawei-ospf-1]`，配置路由协议。

### 1.2 领会
- **路由器端口类型：**
  - **局域网接口（LAN）：** 如以太网口（Ethernet）、快速以太网口（FE）、千兆以太网口（GE）。
  - **广域网接口（WAN）：** 如同步串口（Serial）、POS 接口。
  - **配置管理口：** Console 口（本地配置）、AUX 口（远程拨号配置）。
- **路由器添加模块：**
  - 在模拟器中需先**关闭电源**，将所需业务单板（如 2SA 串口模块）拖入插槽，再开启电源。
- **路由器端口命名规则：**
  - 格式：`槽位号/子卡号/端口号`。
  - 例如：`GigabitEthernet 0/0/0` 表示 0 号槽位、0 号子卡、0 号端口。

### 1.3 应用
- **视图切换与基本操作：**
```bash
<Huawei> system-view                             # 进入系统视图
[Huawei] sysname Router1                         # 修改设备名称
[Router1] interface GigabitEthernet 0/0/0        # 进入接口视图
[Router1-GigabitEthernet0/0/0] quit             # 退回上一级视图
[Router1] return                                 # 直接回到用户视图 (Ctrl+Z)
```
- [截图占位: 模拟器登录与视图切换界面]

---

## 2. 路由器的基本配置
### 2.1 识记
- **认识路由器：** 路由器（Router）是连接两个或多个网络的网络设备，工作在 OSI 的**网络层（Layer 3）**。
- **模块与端口类型的表示方式：**
  - `E`: Ethernet (10Mbps)
  - `Eth`: FastEthernet (100Mbps)
  - `GE`: GigabitEthernet (1000Mbps)
  - `S`: Serial (广域网串口)

### 2.2 领会
- **路由器的工作原理和作用：**
  - **路由选择：** 根据路由表（Routing Table）选择通向目的地址的最佳路径。
  - **分组转发：** 将数据包从入接口转发到正确的出接口。
  - **隔离广播域：** 每个路由器接口都是一个独立的广播域，有效抑制广播风暴。
  - **异构网互联：** 实现不同链路层协议（如以太网、PPP）的网络互联。

### 2.3 应用
- **基本命令应用：**
```bash
[Router1] interface GigabitEthernet 0/0/0
[Router1-GigabitEthernet0/0/0] ip address 192.168.1.1 255.255.255.0  # 配置 IP
[Router1-GigabitEthernet0/0/0] undo shutdown                         # 开启接口
[Router1-GigabitEthernet0/0/0] display this                          # 查看当前配置
<Router1> display ip interface brief                                  # 查看接口状态摘要
<Router1> save                                                        # 保存配置
```

---

## 3. 实现部门计算机动态获取地址 (DHCP)
### 3.1 识记
- **DHCP (Dynamic Host Configuration Protocol)：** 动态主机配置协议，用于自动为网络中的主机分配 IP 地址及相关参数。
- **端口地址池（Interface Address Pool）：** DHCP 服务器直接使用接口所在的网段作为地址池。
- **全局地址池（Global Address Pool）：** 在系统视图下手动创建并配置的地址池，可供多个接口使用。

### 3.2 领会
- **DHCP 的作用：** 减少管理员手工配置 IP 的工作量，避免地址冲突，提高地址利用率。
- **端口地址池与全局地址池的区别：**
  - **端口池：** 配置简单，地址范围固定为接口网段，适用于简单网络。
  - **全局池：** 配置灵活，可跨网段分配，适用于复杂的大中型网络。

### 3.3 应用
- **方法1：端口地址池配置：**
```bash
[Router1] dhcp enable                               # 开启全局 DHCP 功能
[Router1] interface GigabitEthernet 0/0/0
[Router1-GigabitEthernet0/0/0] dhcp select interface # 选择接口地址池方式
[Router1-GigabitEthernet0/0/0] dhcp server dns-list 8.8.8.8 # (可选)配置 DNS
```
- **方法2：全局地址池配置：**
```bash
[Router1] dhcp enable
[Router1] ip pool pool1                             # 创建名为 pool1 的全局池
[Router1-ip-pool-pool1] network 192.168.10.0 mask 24 # 配置网段
[Router1-ip-pool-pool1] gateway-list 192.168.10.1    # 配置网关
[Router1-ip-pool-pool1] dns-list 114.114.114.114     # 配置 DNS
[Router1] interface GigabitEthernet 0/0/1
[Router1-GigabitEthernet0/0/1] dhcp select global    # 关联全局地址池
```

---

## 4. 利用单臂路由实现部门间网络互访
### 4.1 识记
- **单臂路由（Router-on-a-Stick）：** 指在路由器的一个物理接口上通过配置子接口（Sub-Interface）的方式，实现不同 VLAN 间的互访。
- **ARP 广播：** 地址解析协议广播，子接口默认不处理广播报文，需手动开启。

### 4.2 领会
- **单臂路由工作原理：** 交换机通过 Trunk 链路将带 VLAN Tag 的报文发给路由器；路由器子接口根据 Tag 剥离或封装报文并进行三层转发。
- **ARP 广播的作用：** 允许子接口接收和响应 ARP 请求，从而获取对端 MAC 地址以完成封装。

### 4.3 应用
- **单臂路由配置步骤：**
```bash
[Router1] interface GigabitEthernet 0/0/0.10        # 创建子接口 .10
[Router1-GigabitEthernet0/0/0.10] dot1q termination vid 10 # 封装 dot1q 并关联 VLAN 10
[Router1-GigabitEthernet0/0/0.10] ip address 192.168.10.1 24
[Router1-GigabitEthernet0/0/0.10] arp broadcast enable      # 开启 ARP 广播 (关键!)
```
- [截图占位: 单臂路由拓扑与子接口配置图]

---

## 5. 使用静态路由实现网络连通
### 5.1 识记
- **静态路由（Static Route）：** 由网络管理员手动配置的路由，不会随网络拓扑变化自动更新。
- **路由表（Routing Table）：** 路由器内部存储的指导分组转发的数据表，包含目的网络、子网掩码、出接口及下一跳等。

### 5.2 领会
- **静态路由的原理和作用：**
  - **原理：** 管理员明确告知路由器到达某个特定网段的路径。
  - **作用：** 适用于简单、稳定的中小型网络；带宽占用低，安全性高。

### 5.3 应用
- **静态路由配置：**
```bash
# 目的网段 192.168.20.0，掩码 24，下一跳 10.0.0.2
[Router1] ip route-static 192.168.20.0 255.255.255.0 10.0.0.2
```
- **路由表查看与故障分析：**
```bash
<Router1> display ip routing-table                   # 查看完整路由表
<Router1> display ip routing-table 192.168.20.1      # 查看到达特定地址的路径
```

---

## 6. 使用默认路由及浮动路由实现网络连通
### 6.1 识记
- **默认路由（Default Route）：** 一种特殊的静态路由（0.0.0.0/0），当路由表中没有匹配的明细项目时，路由器会选择此路由。
- **浮动路由（Floating Route）：** 配置两条或多条到达同一目的地的静态路由，通过设置不同的优先级（Preference）实现主备备份。

### 6.2 领会
- **默认路由的原理和作用：**
  - **原理：** 匹配所有目的地址。
  - **作用：** 简化路由配置，常用于园区网出口连接 ISP 的场景。
- **浮动路由的原理及应用场合：**
  - **原理：** 正常情况下主路由在路由表中，备份路由（优先级数值更大）处于非活动状态；主路由失效时，备份路由浮出。
  - **应用场合：** 重要业务的冗余链路备份。

### 6.3 应用
- **默认路由配置：**
```bash
[Router1] ip route-static 0.0.0.0 0.0.0.0 202.10.1.1  # 园区网出口网关
```
- **浮动路由配置：**
```bash
[Router1] ip route-static 192.168.2.0 24 10.1.1.2     # 主链路 (默认优先级 60)
[Router1] ip route-static 192.168.2.0 24 10.1.1.6 preference 80 # 备链路 (优先级 80)
```

---

## 7. 使用动态路由 RIPv2 协议实现网络连通
### 7.1 识记
- **RIP 简介：** [待补充]
- **RIP 版本：** [待补充]
- **RIP 定时器：** [待补充]

### 7.2 领会
- **RIP 的原理 and 作用：** [待补充]
- **RIPv1 与 RIPv2 区别：** [待补充]

### 7.3 应用
- **RIPv2 配置：** [待补充]

---

## 8. 使用动态路由 OSPF 协议实现网络连通
### 8.1 识记
- **OSPF 协议简介：** [待补充]
- **OSPF 协议区域：** [待补充]

### 8.2 领会
- **OSPF 协议的原理 and 作用：** [待补充]
- **骨干区域与非骨干区域的区别：** [待补充]

### 8.3 应用
- **OSPF 单区域配置：** [待补充]
