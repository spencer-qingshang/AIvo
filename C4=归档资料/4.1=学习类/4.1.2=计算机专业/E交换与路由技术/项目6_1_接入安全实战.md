# 项目6-1：交换机接入安全实战手册

> **核心目标**：配置交换机端口安全，只允许指定电脑上网；配置 Telnet 远程管理，让管理员能躺在椅子上修设备。
> **场景**：LSW1 是接入交换机，连接 PC1（好人）和 PC2（坏人）。

---

## 一、 环境准备 (手把手搭拓扑)

### 1. 拖动设备
请在 eNSP 左侧工具栏中找到以下设备并拖入画布：
*   **交换机 (Switch)**：选择 **S5700** (或者 S3700 均可)，拖入 1 台，重命名为 `LSW1`。
*   **终端 (End Device)**：选择 **PC**，拖入 2 台，分别重命名为 `PC1` 和 `PC2`。

### 2. 物理连线 (Copper 铜线)
请使用 **Copper (铜轴线)** 进行连接，**注意接口不能插错**：
1.  **PC1** 的 `Ethernet 0/0/1` 接口 <--> 连接到 **LSW1** 的 `GE 0/0/1` 接口。
    *   *说明*：这是“合法员工”的接口。
2.  **PC2** 的 `Ethernet 0/0/1` 接口 <--> 连接到 **LSW1** 的 `GE 0/0/2` 接口。
    *   *说明*：这是“黑客/非法接入者”的接口。

### 3. 开机
选中所有设备，点击工具栏上的 **启动 (Start)** 按钮。等待设备变绿。

### 4. 规划表
| 设备 | 接口 | IP地址 | 网关 (Gateway) | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| **LSW1** | Vlanif 1 | 192.168.1.254/24 | - | 交换机管理IP |
| **PC1** | Eth 0/0/1 | 192.168.1.1/24 | 192.168.1.254 | 员工IP |
| **PC2** | Eth 0/0/1 | 192.168.1.2/24 | 192.168.1.254 | 黑客IP |

**配置提示**：
1.  请**双击** PC 图标，在“基础配置”页签中，严格按照上表填入 **IP地址**、**子网掩码 (255.255.255.0)** 和 **网关**。点击 **应用** 生效。
2.  **给 LSW1 配置管理 IP** (重要！否则后面无法 Ping 通)：
    ```shell
    <Huawei> system-view
    [Huawei] sysname LSW1
    [LSW1] interface vlanif 1
    [LSW1-Vlanif1] ip address 192.168.1.254 24
    [LSW1-Vlanif1] quit
    ```

---

## 二、 端口安全实战 (只认熟脸)

### 1. 开启端口安全
```shell
[LSW1] interface g0/0/1
[LSW1-GigabitEthernet0/0/1] port-security enable
# 大白话：在这个接口上开启“安保模式”。
```

### 2. 配置 Sticky MAC (懒人模式)
```shell
[LSW1-GigabitEthernet0/0/1] port-security mac-address sticky
# 大白话：开启“粘性记录”功能。交换机会自动记住第一个连上来的 MAC 地址，并把它当成唯一的合法用户。
[LSW1-GigabitEthernet0/0/1] port-security max-mac-num 1
# 大白话：这个接口最多只允许 1 个设备通过。多了就报警。
[LSW1-GigabitEthernet0/0/1] port-security protect-action shutdown
# 大白话：如果发现非法设备（MAC 不对），直接把接口“shutdown”（关掉）。这是最狠的惩罚。
```

### 3. 验证
*   让 PC1 ping 网关 `192.168.1.254`，**能通**。此时交换机已经记住了 PC1 的 MAC。
*   **模拟攻击**：拔掉 PC1 的线，把 PC2 的线插到 `GE 0/0/1` 接口上。
*   让 PC2 ping 网关。
*   **结果**：PC2 一发包，LSW1 的 `GE 0/0/1` 接口指示灯立马**变红 (Shutdown)**。
*   **恢复方法**：管理员手动在接口下输 `undo shutdown`。

---

## 三、 远程管理实战 (Telnet + AAA)

### 1. 配置 AAA 认证 (创建账号)
```shell
[LSW1] aaa
[LSW1-aaa] local-user admin password cipher huawei@123
# 大白话：创建一个本地用户叫 admin，密码是 huawei@123（加密存储）。
[LSW1-aaa] local-user admin privilege level 15
# 大白话：给 admin 最高权限（15级），也就是什么都能干。
[LSW1-aaa] local-user admin service-type telnet
# 大白话：规定 admin 这个账号只能用来登录 Telnet，不能干别的。
[LSW1-aaa] quit
```

### 2. 开启 Telnet 服务通道 (VTY)
```shell
[LSW1] user-interface vty 0 4
# 大白话：打开 0 到 4 号共 5 个虚拟通道，允许 5 个人同时远程登录。
[LSW1-ui-vty0-4] authentication-mode aaa
# 大白话：进门的时候，必须用 AAA 那套流程（查账号密码）来验证身份。
[LSW1-ui-vty0-4] quit
```

### 3. 验证
*   在 PC1 的命令行里输入 `telnet 192.168.1.254`。
*   输入用户名 `admin`，密码 `huawei@123`。
*   成功进入 `<LSW1>` 界面，说明远程管理配置成功。

### 4. 专业命令验证 (不只是Ping)
*   **查看端口安全状态**：
    ```shell
    [LSW1] display port-security interface g0/0/1
    ```
    *   查看 `Port Security Enable` 是否为 `Enable`。
    *   查看 `Protect Action` 是否为 `Shutdown`。
*   **查看当前登录用户**：
    ```shell
    [LSW1] display users
    ```

---

## 四、 保存配置 (必做!)

**非常重要**：在真实设备上，如果不保存，断电后配置就丢了。
```shell
<LSW1> save
The current configuration will be written to the device.
Are you sure to continue? [Y/N] y
Info: Please input the file name ( *.cfg, *.zip ) [vrpcfg.zip]: (直接回车)
```