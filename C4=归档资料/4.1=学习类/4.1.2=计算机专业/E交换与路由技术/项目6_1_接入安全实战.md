# 项目6-1：交换机接入安全实战手册

> **核心目标**：配置交换机端口安全，只允许指定电脑上网；配置 Telnet 远程管理，让管理员能躺在椅子上修设备。
> **场景**：LSW1 是接入交换机，连接 PC1（好人）和 PC2（坏人）。

---

## 一、 环境准备 (拓扑搭建)

### 1. eNSP 拓扑
*   **LSW1**: S5700 交换机。
*   **PC1**: 员工电脑（MAC: 54-89-98-F0-11-22）。
*   **PC2**: 黑客电脑（MAC: 54-89-98-F0-33-44）。
*   **连线**：
    *   PC1 -> GE 0/0/1
    *   PC2 -> GE 0/0/2

### 2. 规划表
| 设备 | 接口 | IP地址 | 说明 |
| :--- | :--- | :--- | :--- |
| **LSW1** | Vlanif 1 | 192.168.1.254/24 | 交换机管理IP |
| **PC1** | Eth 0/0/1 | 192.168.1.1/24 | 员工IP |

---

## 二、 端口安全实战 (只认熟脸)

### 1. 开启端口安全
```shell
<Huawei> system-view
[Huawei] sysname LSW1
[LSW1] interface g0/0/1
[LSW1-GigabitEthernet0/0/1] port-security enable
# 大白话：在这个接口上开启“安保模式”。
```

### 2. 配置 Sticky MAC (懒人模式)
```shell
[LSW1-GigabitEthernet0/0/1] port-security mac-address sticky
# 大白话：开启“粘性记录”功能。交换机会自动记住第一个连上来的 MAC 地址，并把它当成唯一的合法用户。
[LSW1-GigabitEthernet0/0/1] port-security max-mac-num 1
# 大白话：这个接口最多只允许 1 个设备通过。多了就报警。
[LSW1-GigabitEthernet0/0/1] port-security protect-action shutdown
# 大白话：如果发现非法设备（MAC 不对），直接把接口“shutdown”（关掉）。这是最狠的惩罚。
```

### 3. 验证
*   让 PC1 ping 网关，通了。
*   拔掉 PC1，换上 PC2（黑客）。
*   PC2 一发包，接口立马变红（shutdown）。
*   **恢复方法**：管理员手动在接口下输 `undo shutdown`。

---

## 三、 远程管理实战 (Telnet + AAA)

### 1. 配置管理 IP
```shell
[LSW1] interface vlanif 1
[LSW1-Vlanif1] ip address 192.168.1.254 24
```

### 2. 配置 AAA 认证 (创建账号)
```shell
[LSW1] aaa
[LSW1-aaa] local-user admin password cipher huawei@123
# 大白话：创建一个本地用户叫 admin，密码是 huawei@123（加密存储）。
[LSW1-aaa] local-user admin privilege level 15
# 大白话：给 admin 最高权限（15级），也就是什么都能干。
[LSW1-aaa] local-user admin service-type telnet
# 大白话：规定 admin 这个账号只能用来登录 Telnet，不能干别的。
[LSW1-aaa] quit
```

### 3. 开启 Telnet 服务通道 (VTY)
```shell
[LSW1] user-interface vty 0 4
# 大白话：打开 0 到 4 号共 5 个虚拟通道，允许 5 个人同时远程登录。
[LSW1-ui-vty0-4] authentication-mode aaa
# 大白话：进门的时候，必须用 AAA 那套流程（查账号密码）来验证身份。
[LSW1-ui-vty0-4] quit
```

### 4. 验证
*   在 PC1 的命令行里输入 `telnet 192.168.1.254`。
*   输入用户名 `admin`，密码 `huawei@123`。
*   成功进入 `<LSW1>` 界面，说明远程管理配置成功。
